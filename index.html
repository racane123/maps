<!DOCTYPE html>
<html>
  <head>
    <title>Mapbox Example with Custom Geolocation Button</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        height: 90vh;
      }
      #geolocateButton {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1;
        background-color: #fff;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        cursor: pointer;
      }
      .viewButton {
        cursor: pointer;
        color: blue;
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div id="geolocateButton">Locate Me</div>
    <div id="map"></div>
    <table id="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Name</th>
          <th>Action</th>
          <!-- Add more headers as needed based on your API response -->
        </tr>
      </thead>
      <tbody>
        <!-- Data rows will be added dynamically -->
      </tbody>
    </table>
    <script>
      mapboxgl.accessToken =
        "pk.eyJ1Ijoia3Jha2VuMTIzIiwiYSI6ImNsdHU1M3V3ajFhZjUya21vcGMwNG9ldDQifQ.B5h0r_S1blXJS0mJMgwYIA";
      var map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/streets-v11",
        center: [-74.5, 40],
        attributionControl: false,
        zoom: 9,
      });
      map.addControl(new mapboxgl.NavigationControl(), "top-right");
      // Add geolocation control
      var geolocate = new mapboxgl.GeolocateControl({
        positionOptions: {
          enableHighAccuracy: true,
        },
        trackUserLocation: true,
      });
      map.addControl(geolocate);

      // Add event listener to custom geolocation button
      var geolocateButton = document.getElementById("geolocateButton");
      geolocateButton.addEventListener("click", function () {
        geolocate.trigger();
      });

      // Add GeoJSON source for selected polygon or point
      map.on("style.load", function () {
        map.addSource("selected-feature", {
          type: "geojson",
          data: {
            type: "FeatureCollection",
            features: [], // Empty features array initially
          },
        });

        // Add a layer to render the GeoJSON data
        map.addLayer({
          id: "selected-feature-layer",
          type: "fill",
          source: "selected-feature",
          paint: {
            "fill-color": "#088",
            "fill-opacity": 0.5,
          },
        });
      });

      fetch("http://localhost/map-box-drawingboundary/api/polyapi.php")
        .then((response) => response.json())
        .then((jsonData) => {
          const tableBody = document.querySelector("#data-table tbody");
          jsonData.features.forEach((feature) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                    <td>${feature.properties.id}</td>
                    <td>${feature.properties.title}</td>
                    <td>${feature.properties.name}</td>  
                    <td>${
                      feature.geometry.type === "Polygon"
                        ? '<button class="viewButton" onclick="viewPolygon(' +
                          JSON.stringify(feature.geometry.coordinates) +
                          ')">View Polygon</button>'
                        : feature.geometry.type === "Point"
                        ? '<button class="viewButton" onclick="viewPoint(' +
                          JSON.stringify(feature.geometry.coordinates) +
                          ')">View Point</button>'
                        : ""
                    }</td>`;
            tableBody.appendChild(row);
          });
        })
        .catch((error) => console.error("Error fetching data:", error));

      function viewPolygon(coordinates) {
        const geojson = {
          type: "Feature",
          geometry: {
            type: "Polygon",
            coordinates: coordinates,
          },
          properties: {},
        };
        map.getSource("selected-feature").setData(geojson);

        // Check if the data source contains GeoJSON data
        const dataSource = map.getSource("selected-feature");
        if (dataSource && dataSource._data) {
          console.log("Polygons are displayed on the map.");
        } else {
          console.log("Polygons are not displayed on the map.");
        }
      }

      function viewPoint(coordinates) {
        const geojson = {
          type: "Feature",
          geometry: {
            type: "Point",
            coordinates: coordinates,
          },
          properties: {},
        };
        map.getSource("selected-feature").setData(geojson);

        // Check if the data source contains GeoJSON data
        const dataSource = map.getSource("selected-feature");
        if (dataSource && dataSource._data) {
          console.log("Point is displayed on the map.");
        } else {
          console.log("Point is not displayed on the map.");
        }
      }
    </script>
  </body>
</html>
